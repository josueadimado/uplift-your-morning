{% extends 'admin/custom_base.html' %}

{% block admin_content %}
<div class="mb-6">
    <a href="{% url 'manage:questions_list' %}"
       class="inline-flex items-center text-sm font-semibold mb-4"
       style="color: var(--primary);">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Back to Questions
    </a>
    <h1 class="text-2xl sm:text-3xl font-bold mb-2" style="color: var(--text);">Question from {{ question.name }}</h1>
    <p class="text-sm sm:text-base" style="color: var(--text_secondary);">{{ question.get_category_display }} Â· {{ question.created_at|date:"F d, Y g:i A" }}</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main content -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Question -->
        <div class="bg-white rounded-lg shadow p-6 border" style="border-color: var(--border);">
            <h2 class="text-xl font-bold mb-4" style="color: var(--text);">Question</h2>
            <p class="text-base whitespace-pre-wrap" style="color: var(--text);">{{ question.question }}</p>
        </div>

        <!-- Reply (view or form) -->
        <div class="bg-white rounded-lg shadow p-6 border" style="border-color: var(--border);">
            <h2 class="text-xl font-bold mb-4" style="color: var(--text);">Your Reply</h2>
            {% if question.reply %}
            <p class="text-base whitespace-pre-wrap mb-4" style="color: var(--text);">{{ question.reply }}</p>
            {% if question.replied_at %}
            <p class="text-sm" style="color: var(--text_secondary);">Replied {{ question.replied_at|date:"F d, Y g:i A" }}</p>
            {% endif %}
            <p class="text-sm mt-4" style="color: var(--text_secondary);">You can update the reply below.</p>
            {% else %}
            <p class="text-sm mb-4" style="color: var(--text_secondary);">No reply yet. Add a reply below to mark this as answered.</p>
            {% endif %}

            <form method="post" action="{% url 'manage:question_reply' question.pk %}" class="mt-4">
                {% csrf_token %}
                <textarea name="reply"
                          rows="6"
                          class="w-full px-4 py-2 border rounded-lg mb-4"
                          style="border-color: var(--border);"
                          placeholder="Type your reply here...">{% if question.reply %}{{ question.reply }}{% endif %}</textarea>
                <button type="submit"
                        class="px-6 py-2 rounded-lg font-semibold text-white"
                        style="background: var(--primary);">
                    {% if question.reply %}Update Reply{% else %}Save Reply & Mark Answered{% endif %}
                </button>
            </form>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
        <!-- Contact -->
        <div class="bg-white rounded-lg shadow p-6 border" style="border-color: var(--border);">
            <h2 class="text-xl font-bold mb-4" style="color: var(--text);">Contact</h2>
            <div class="space-y-2 text-sm">
                <div>
                    <p class="font-medium mb-1" style="color: var(--text_secondary);">Name</p>
                    <p style="color: var(--text);">{{ question.name }}</p>
                </div>
                <div>
                    <p class="font-medium mb-1" style="color: var(--text_secondary);">Email</p>
                    <a href="mailto:{{ question.email }}" class="break-all" style="color: var(--primary);">{{ question.email }}</a>
                </div>
            </div>
        </div>

        <!-- Status -->
        <div class="bg-white rounded-lg shadow p-6 border" style="border-color: var(--border);">
            <h2 class="text-xl font-bold mb-4" style="color: var(--text);">Status</h2>
            <span class="px-3 py-1 rounded text-sm font-semibold
                {% if question.status == 'pending' %}bg-yellow-100 text-yellow-800
                {% else %}bg-green-100 text-green-800{% endif %}">
                {{ question.get_status_display }}
            </span>
        </div>

        <!-- Timestamps -->
        <div class="bg-white rounded-lg shadow p-6 border" style="border-color: var(--border);">
            <h2 class="text-xl font-bold mb-4" style="color: var(--text);">Timestamps</h2>
            <div class="space-y-2 text-sm">
                <div>
                    <p class="font-medium mb-1" style="color: var(--text_secondary);">Submitted</p>
                    <p style="color: var(--text);">{{ question.created_at|date:"F d, Y g:i A" }}</p>
                </div>
                <div>
                    <p class="font-medium mb-1" style="color: var(--text_secondary);">Last Updated</p>
                    <p style="color: var(--text);">{{ question.updated_at|date:"F d, Y g:i A" }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
